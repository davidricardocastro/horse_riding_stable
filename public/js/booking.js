var select_date="";var selected_slot_id=null;var n_of_spots=3;var n_students=1;var available_spots=1;$(function(){initialize()});function initialize(){$("#confirm_buttons").css('display','none');$("#booking_confirmation").css('display','none');$("#booking_sent").css('display','none');$("#accordion").css('display','none');console.log("stuff is hidden");$("#datepicker").datepicker({onSelect:function(date,inst){select_date=date;$.ajax({method:'get',url:'{{ action('Api\ReservationController@display_reservation')}}',data:{date:select_date},success:function(data){console.log(data);$('#table_mobile').empty();$.each(data,function(i,slot){var one_tr=$('<tr>\
<td class="slot_data">\
</td>\
<td class="slot unchecked">\
</td>\
</tr>');if(slot.n_students>0){var slot_full_description='Class: '+slot.description+'<br>Available spots = '+slot.n_students;one_tr.find('.slot').html(slot_full_description);var lesson_start_range=slot.lesson_start.slice(10,16);var lesson_end_range=slot.lesson_end.slice(10,16);var lesson_hour_range=lesson_start_range+' - '+lesson_end_range;one_tr.find('.slot_data').html(lesson_hour_range);one_tr.data('id',slot.id);one_tr.data('n_students',slot.n_students);$('#table_mobile').append(one_tr);one_tr.click(function(ev){selected_slot_id=$(this).data('id');n_students=$(this).data('n_students');$(this).css("color","blue").css("font-weight","bold")})}});activateSlots()}});$("#accordion").css('display','block')},beforeShowDay:function(date){var yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);return[date.getTime()>yesterday.getTime()]}});$("#accordion").accordion({collapsible:!0,heightStyle:"content"})}
function activateSlots(){$('.slot').click(function(){$("#confirm_buttons").css('display','block');n_of_spots=1})}
$('#confirm').on('click',function(){$("#booking_confirmation").dialog();confirmCheck()});$('#add_spot_counter').on('click',function(){n_of_spots++;confirmCheck()});$('#remove_spot_counter').on('click',function(){n_of_spots--;confirmCheck()});function confirmCheck(){available_spots=n_students-n_of_spots;if(n_of_spots>1)
{$('#remove_spot_counter').show()}
else{$('#remove_spot_counter').hide()}
if(n_students>n_of_spots){$('#add_spot_counter').show();displaySlotCount()}
else{displaySlotMax();$('#add_spot_counter').hide()}}
function displaySlotCount(){$("#add_spots").text("You have reserved for "+n_of_spots+" student(s). You can add up to "+available_spots+" more")}
function displaySlotMax(){$("#add_spots").text(n_students+" is the maximum spots for this reservation")}
$('#reset').on('click',function(){initialize()});$('#accept').on('click',function(){$.ajax({method:'post',url:'{{ action('Api\ReservationController@create_reservation') }}',data:{id:selected_slot_id,user_id:{{$user_id}},n_of_spots:n_of_spots,n_students:n_students},success:function(data){}});$("#booking_confirmation").dialog("close");$("#booking_sent").dialog()});$('#cancel').on('click',function(){$("#booking_confirmation").dialog("close")});$('#back').on('click',function(){$("#booking_sent").dialog("close");$("#booking_confirmation").dialog("close");$("#accordion").css('display','none');$("#confirm_buttons").css('display','none');initialize()})